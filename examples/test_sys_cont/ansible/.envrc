#!/usr/bin/env zsh

# This .envrc file is called by direnv (https://direnv.net/) to automatically 
# execute this script when entering this directory or one of it's child 
# directories

# Automatically load pipenv which allows execution of the pinned Ansible 
# version to use defined in the IaC Project directory. pipenv searches parent
# directories until it finds a Pipfile and Pipfile.lock and references it for
# creating a python virtual environment to execute Ansible from. If a Pipfile
# and Pipfile.lock existed in this directory it would override the IaC Project
# defintions with something specifically used in this IaC Implementation.
pipenv sync
source "$(pipenv --venv)/bin/activate"

# Change the PS1 prefix to use the IaC implementation name if a Pipfile exists
# in this directory
if [ -f Pipfile ]; then
    CUSTOM_DIRENV_PS1_PREFIX="($(basename "$(dirname "$(pwd)")")) "
    export CUSTOM_DIRENV_PS1_PREFIX
    VIRTUAL_ENV_PROMPT=""
fi